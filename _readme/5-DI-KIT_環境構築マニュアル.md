社内用

DI-KIT 環境構築マニュアル
==================================================

ICT Webコーディング・スターターキット

* 日付：2021.05.18
* 作成：ICT株式会社 長尾一矢



はじめに
--------------------------------------------------

ICT株式会社のコーディング用スターターキット、DI-KITを用いたコーディング環境構築を実行するためのドキュメントです。

本ドキュメントに基づいて、以下に記載する環境をローカルPCに構築してください。


環境について
--------------------------------------------------

### 制作環境

ローカルサーバーを立ち上げ、`public/`をルートパスとして、 http://localhost:3000 で閲覧できるようになります。  
（`public/index.html`がトップページとして表示されます）
  
その他、制作の編集時には、以下の処理が常駐して走るようにしています。

1. ファイル保存に対応したオートリロード
* SassによるCSSコンパイル
* JSファイルのビルド・トランスパイル


### 必要なツール

* Node.js
* Sass
* Gulp　
* browser-sync
* webpack

上記の構築方法やコーディング時の操作方法などを順を追って説明します。



<div class="new_page" style="page-break-after:always"></div><!--印刷改頁-->


目次
--------------------------------------------------

1. **DI-KITを初めて使う場合の手順**
	* Node.jsのインストール
	* グローバル領域へのNode.jsモジュールのインストール
2. **案件着手時の手順**
	* 案件ごとに必要となるモジュールのインストール
3. **編集する時の手順**
	* ファイルを編集する前に実行する手順
4. **ローカルサーバー**
	* ローカルサーバーについて
5. **トラブルシューティング**
	* _start.bat起動時にエラーが出たら


【参考】DI-KITファイル・ディレクトリ構造
--------------------------------------------------
以下は、DI-KITの初期状態の構造です。

* DI_KIT-corporate-Template/　…　<small>案件名に書き換える</small>
	* _config/　…　<small>ローカルサーバーのポート設定とSassのコンパイル設定</small>
	* _install/　…　<small>DI-KITのインストール用バッチファイル</small>
	* _readme/ … <small>DI-KITに関する説明ドキュメント</small>
	* document/　…　<small>コーディングルールやツール、デザインファイルなどのドキュメント類</small>
	* origin/　…　<small>コンパイル前のSassやjsのデータ</small>
	* public/　…　<small>Webサイトのデータ（公開サーバーへデプロイするもの）</small>
	* .editorconfig　…　<small>対応したテキストエディタでコード書式を統一するための設定ファイル</small>
	* .gitignore　…　<small>Git除外ファイルの定義</small>
	* _start.bat　…　<small>編集開始（再開）時に起動するbatファイル</small>
	* gulpfile.js　…　<small>gulp（タスクランナー）の設定ファイル</small>
	* package-lock.json　…　<small>npmのパッケージ管理ファイル</small>
	* package.json　…　<small>npmのパッケージ管理およびコマンド管理ファイル</small>
	* webpack.config.jp　…　<small>JSビルド・トランスパイル設定</small>


<div class="new_page" style="page-break-after:always"></div><!--印刷時の改ページ-->




1. DI-KITを初めて使う場合の手順
==================================================

DI-KITでの制作環境には「Node.js」を使用するため、インストールが必要です。  
現在、ICT社内はWindows環境で統一されているため、Windowsに限定してインストール手順を説明します。

これは、DI-KITを初めて使う際に1回だけ実行してください。（以後の案件での実行は不要です）


1-1. Node.jsのインストール
--------------------------------------------------
既にNode.jsがインストールされている場合にはこの手順は不要ですが、Node.jsやnpmのバージョンが異なると動作しない可能性があります。  
本マニュアル内の手順に合わせる場合は、現在インストールされているNode.jsをアンインストールしてから始めてください。

### インストール方法

以下URLのいずれかから、v14.15.4のWindowsインストーラーをダウンロードし、Node.jsをインストールします。  
※クリックすると直接ダウンロードが開始します。

* 64bitOS用 [https://nodejs.org/download/release/v14.15.4/node-v14.15.4-x64.msi](https://nodejs.org/download/release/v14.15.4/node-v14.15.4-x64.msi)
* 32bitOS用 [https://nodejs.org/download/release/v14.15.4/node-v14.15.4-x86.msi](https://nodejs.org/download/release/v14.15.4/node-v14.15.4-x86.msi)


###  完了確認
上記のインストール状況を確認します。

1. コマンドプロンプトを起動（Windows10の場合はPowerShellでも可）
2. コマンドで`node -v`と入力してEnterキーを押し、「v14.15.4」と表示されることを確認
3. 続けて`npm -v`と入力してEnter、「6.14.10」と表示されることを確認する
4. 問題なければNode.jsのインストールは完了

上記が確認できれば、コマンドプロンプトは閉じて下さい。



<div class="new_page" style="page-break-after:always"></div><!--印刷時の改ページ-->



1-2. グローバル領域へのNode.jsモジュールのインストール
--------------------------------------------------
グローバル領域に、Node.jsのモジュールをインストールします。  

### インストールされるモジュールについて

`install-global.bat`は、以下のモジュールを`npm install -g`でインストールする簡易なバッチファイルです。  
コマンドラインを扱える方は手動で同じ処理を実行していただいても構いません。

* browser-sync@2.26.3
* gulp-cli@2.1.0
* webpack@4.30.0
* webpack-cli@3.2.2
* webpack-stream@5.2.1

### インストール方法

1. DI-KIT内の`_install/only_first/install-global.bat`をダブルクリックして起動する
2. 処理が完了するのを待つ（数分かかる）

※Mac環境の場合は、`npm install -g browser-sync@2.26.3`のように、上記「インストールされるモジュール」をターミナルからコマンドでそれぞれインストールしてください


<div class="new_page" style="page-break-after:always"></div><!--印刷時の改ページ-->



2. 案件着手時の手順
==================================================

案件のコーディング開始時には、グローバル領域とは異なるNode.jsモジュールを、案件ごとに個別にインストールする必要があります。



2-1. 案件ごとに必要となるモジュールのインストール
--------------------------------------------------

### インストールされるモジュールについて

`install.bat`は、`npm install`を実行するだけの簡易なバッチファイルです。  
コマンドラインを扱える方は手動で同じ処理を実行していただいても構いません。

実行すると以下のファイルがプロジェクトディレクトリの`node_modules/`内にインストールされます。

インストールされるモジュールの内容は、package.jsonを参照してください。

package.jsonに記述されているもの以外にも、案件ごとに必要なモジュールがあれば適宜インストールして構いません。


### インストール方法

1. `_install/install.bat`をダブルクリック
2. 処理が完了するのを待つ（数分かかる）

※Mac環境の場合はターミナルからコマンドで`npm install`を実行してください


<div class="new_page" style="page-break-after:always"></div><!--印刷時の改ページ-->



3. 編集する時の手順
==================================================
コーディングをおこなう前に実行する手順です。  
手順1、2が完了していれば、作業再開時はこのステップから開始します。

3-1. ファイルを編集する前に実行する手順
--------------------------------------------------

### 実行手順

1. `_start.bat`をダブルクリック
2. 編集が終わるまでコマンドプロンプトは閉じず、起動したままにしておきます

`_start.bat`はコマンドラインで`gulp`を実行するだけの簡易なバッチファイルです。  
コマンドラインを扱える方は手動で同じ処理を実行していただいても構いません。

※Mac環境の場合はターミナルからコマンドで`gulp`を実行してください

### 実行される内容

_start.batをダブルクリックすると、コマンドプロンプトが立ち上がり以下3つのgulpタスクが常駐します。

* Sassコンパイルのwatch
* JSビルド・トランスパイルのwatch
* ローカルサーバーの起動


### 終了時

編集が終わったら、「1. 実行手順」で起動したコマンドプロンプトを閉じてください。


<div class="new_page" style="page-break-after:always"></div>


4. ローカルサーバー
==================================================

4-1. ローカルサーバーについて
--------------------------------------------------

`browser-sync`を使用したローカルサーバーを使用しています。

### アクセス時のURL

標準では[http://localhost:3000](http://localhost:3000)となっています。  
上記URLでアクセスすると、`public/index.html`が表示されます。

### ポート番号の変更

ポート番号を変更したい場合は、`_config/config-port.json`に記述しているポート番号を書き換えます。


#### ポート重複の自動回避

`_start.bat`を実行中のコマンドプロンプトが同時に複数立ち上がっている場合、  
ポート設定が重複すると後から起動したほうのポートを自動的に変更して立ち上がるため、  
`_config/config-port.json`の設定とは異なるポートで立ち上がります。

### オートリロード

`public/`内で、以下のファイルが更新された場合にブラウザがオートリロードされます。

* HTMLファイル
* CSSファイル
* JSファイル

#### オートリロード時の留意点

稀に一部文字化けして表示される場合がありますが、手動でブラウザをリロードすれば治ります。


4-2. Webサーバー上の公開対象ファイル
--------------------------------------------------

SassやJSの元データを`origin/`ディレクトリ内に集約することで、サイト公開時に不要なファイルを除外しやすくなっています。

Webサーバー上で公開されるのは、`public/`ディレクトリ内のファイルだけが対象となります。  


<div class="new_page" style="page-break-after:always"></div><!--印刷時の改ページ-->


5. トラブルシューティング
==================================================

5-1. _start.bat起動時にエラーが出たら
--------------------------------------------------

以下いずれかの原因が考えられます。


### パターンA: Sassコンパイルに失敗している

Sassのwatchに入る前に一度コンパイルしているため、初回コンパイルに失敗するとwatchに移行せずエラーで停止します。

#### 確認ポイント

* Sassで`@import`している対象ファイルが存在しているか
	* パスを間違えていないか
* Sassのシンタックスエラーがないか


### パターンB: JSビルドに失敗している

JSのwatchに入る前に一度結合しているため、初回ビルドに失敗するとwatchに移行せずエラーで停止します。

#### 確認ポイント

* `origin/_js/script.js`・`origin/_js/内の各ファイル`で`import`している対象ファイルが存在しているか
	* パスを間違えていないか
* import文の書き方に問題がないか
* JavaScriptのシンタックスエラーがないか

### パターンC: 案件ごと個別のNode.jsモジュールがインストールされていない

_start.batで起動する機能にはNode.jsモジュールが必要です。

#### 確認ポイント

* 案件の最初に`_install/install.bat`をダブルクリックしたか
* インストール時にエラーは出ていなかったか




<div class="new_page" style="page-break-after:always"></div><!--印刷時の改ページ-->



